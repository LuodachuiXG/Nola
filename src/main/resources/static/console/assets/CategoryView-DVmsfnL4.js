import{d as K,D as W,n as U,o as f,w as l,a as o,u as a,F as se,B as D,c as N,p as w,G as S,S as re,T as ie,M as V,b as M,J as z,m as B,X as ue,Y as de,r as ce,R as ge,f as d,br as h,g as ve,h as pe,Z as fe,$ as L,ar as me,y as ye,a0 as he,a1 as Ce,aE as Ne,t as ke,A as _,x as A,at as Ie,P as _e,a3 as De,V as we,I as Se,aF as be,aG as Ee,a5 as Ae,Q as xe,U as Ue,a6 as Be,s as x,aH as Pe,a8 as q,aA as $e,j as Oe}from"./index-C97z5PQV.js";import{b as Fe,c as Te,a as Ge,u as Re,d as Ve}from"./categoryApi-BEd6Ph2p.js";import{N as Me}from"./ButtonGroup-crtXYHAe.js";import{N as ze}from"./Badge-Dj7OGGqR.js";const Le={style:{"margin-right":"-10px"}},qe={key:0},Ke={key:0},We=K({__name:"CategoryListItem",props:{category:{},isChecked:{type:Boolean}},emits:["onEditCategory","onDeleteCategory","onChecked","onUnChecked"],setup(P,{emit:b}){const u=P,r=W(),g=b,m=i=>{g("onEditCategory",i)},k=i=>{g("onDeleteCategory",i)},I=i=>{g(i?"onChecked":"onUnChecked",u.category)},v=()=>{ce.push({name:ge.POST.name,query:{categoryId:u.category.categoryId}})};return(i,c)=>(f(),U(a(de),null,{default:l(()=>[o(a(se),{class:"animate__animated animate__fadeIn"},{avatar:l(()=>[B("div",Le,[o(a(ue),{checked:i.isChecked,style:{"margin-left":"-4px","margin-right":"12px"},onUpdateChecked:I},null,8,["checked"])])]),header:l(()=>[o(a(ze),{class:"none-select pointer",value:i.category.postCount??0,offset:[10,0],type:"info",onClick:v},{default:l(()=>[B("div",null,[o(a(V),{strong:""},{default:l(()=>[M(z(i.category.displayName),1)]),_:1})])]),_:1},8,["value"])]),description:l(()=>[o(a(V),{depth:"3"},{default:l(()=>[M(z(i.category.slug),1)]),_:1})]),"header-extra":l(()=>[o(a(Me),{size:"small"},{default:l(()=>[o(a(D),{type:"default",tertiary:"",onClick:c[0]||(c[0]=y=>m(i.category))},{icon:l(()=>[o(a(S),null,{default:l(()=>[o(a(re))]),_:1})]),default:l(()=>[a(r).isSmallWindow?w("",!0):(f(),N("span",qe,"设置"))]),_:1}),o(a(D),{type:"error",tertiary:"",onClick:c[1]||(c[1]=y=>k(i.category))},{icon:l(()=>[o(a(S),null,{default:l(()=>[o(a(ie))]),_:1})]),default:l(()=>[a(r).isSmallWindow?w("",!0):(f(),N("span",Ke,"删除"))]),_:1})]),_:1})]),_:1})]),_:1}))}}),Ye={class:"container"},Ze={key:0},Xe=K({__name:"CategoryView",setup(P){const b=W(),u=d(null),r=d(Array()),g=d(1),m=d(10),k=d(0),I=d(0),v=d(h.ADD),i=d(null),c=d(!1),y=d(!1),n=ve({categoryId:-1,displayName:"",slug:"",cover:null,unifiedCover:!1}),E=d(!1),Y=fe();pe(()=>{Z();let e=Number(Y.query.categoryId);isNaN(e)||Fe(Number(e)).then(t=>{O(t.data)}).catch(()=>{}),C()});const Z=()=>{let e=Number(localStorage.getItem(L.CATEGORY_PAGE_SIZE.toString())??10);isNaN(e)||e<10||e>120?m.value=10:m.value=e},C=()=>{window.$loadingBar.start(),Te(g.value,m.value).then(e=>{var p;let t=e.data;if(((p=t.data)==null?void 0:p.length)===0&&t.totalData!==0){g.value=1,C();return}u.value=t.data,k.value=t.totalData,I.value=t.totalPages,window.$loadingBar.finish()}).catch(()=>{window.$loadingBar.error()})},j=e=>{q("确定要删除分类 ["+(e==null?void 0:e.displayName)+"] 吗？此操作不可逆。",()=>{$([e.categoryId])})},H=()=>{let e=Array();r.value.forEach(t=>{e.push(t)}),q(`确定要删除选择的 ${e.length} 个分类吗？`,()=>{$(e)})},$=e=>{Ve(e).then(()=>{x("删除成功"),r.value=r.value.filter(t=>!e.includes(t)),C()}).catch(()=>{})},O=e=>{G(),n.categoryId=e.categoryId,n.displayName=e.displayName,n.slug=e.slug,n.cover=e.cover,n.unifiedCover=e.unifiedCover,v.value=h.EDIT,c.value=!0},J=()=>{G(),v.value=h.ADD,c.value=!0},F=()=>{var e;return(e=i.value)==null||e.validate(t=>{if(!t){y.value=!0;let p={categoryId:n.categoryId,displayName:n.displayName,slug:encodeURIComponent(n.slug),cover:n.cover,unifiedCover:n.unifiedCover};v.value===h.ADD?Ge(p).then(()=>{x("添加成功"),T()}).catch(()=>{y.value=!1}):Re(p).then(()=>{x("修改成功"),T()}).catch(()=>{y.value=!1})}}).catch(()=>{}),!1},T=()=>{y.value=!1,c.value=!1,C()},G=()=>{n.categoryId=-1,n.displayName="",n.slug="",n.cover=null,n.unifiedCover=!1},Q=e=>{n.displayName=e,v.value===h.ADD&&(n.slug=Pe(e))},X=e=>{g.value=e,C()},ee=e=>{m.value=e,localStorage.setItem(L.CATEGORY_PAGE_SIZE.toString(),e.toString()),C()},ae=e=>{r.value.push(e.categoryId)},te=e=>{r.value=r.value.filter(t=>t!==e.categoryId)},oe=()=>{var e;r.value=[],(e=u.value)==null||e.forEach(t=>{r.value.push(t.categoryId)})},le=()=>{r.value=[]},ne=e=>{let t=e[0];if(!$e(t.displayName)){Oe("只能选择图片文件");return}n.cover=t.url};return(e,t)=>{var p,R;return f(),N("div",Ye,[o(me,{show:E.value,"onUpdate:show":t[0]||(t[0]=s=>E.value=s),multiple:!1,onOnConfirm:ne},null,8,["show"]),o(a(he),{show:c.value,"onUpdate:show":t[6]||(t[6]=s=>c.value=s),preset:"dialog",title:v.value==a(h).ADD?"添加分类":"分类设置","positive-text":v.value==a(h).ADD?"添加":"保存","negative-text":"取消",loading:y.value,onPositiveClick:F,onKeydown:ye(F,["enter"])},{default:l(()=>[o(a(Ne),{style:{"max-height":"70vh","padding-right":"12px"}},{default:l(()=>[o(a(ke),{ref_key:"addEditDialogRef",ref:i,class:"dialog-form",model:n,style:{margin:"10px 5px"}},{default:l(()=>[o(a(_),{label:"分类名",path:"displayName",rule:{required:!0,message:"请输入分类名"}},{default:l(()=>[o(a(A),{"default-value":n.displayName,"onUpdate:defaultValue":t[1]||(t[1]=s=>n.displayName=s),placeholder:"分类名",onUpdateValue:Q,maxlength:"50"},null,8,["default-value"])]),_:1}),o(a(_),{label:"分类别名",path:"slug",rule:{required:!0,message:"请输入分类别名"}},{default:l(()=>[o(a(A),{value:n.slug,"onUpdate:value":t[2]||(t[2]=s=>n.slug=s),placeholder:"分类别名",maxlength:"50"},null,8,["value"])]),_:1}),o(a(_),{label:"统一封面（如果文章未设置封面）",path:"unifiedCover"},{default:l(()=>[o(a(Ie),{value:n.unifiedCover,"onUpdate:value":t[3]||(t[3]=s=>n.unifiedCover=s)},null,8,["value"])]),_:1}),o(a(_),{label:"封面",path:"cover"},{default:l(()=>[o(a(_e),{vertical:"",style:{width:"100%"}},{default:l(()=>[o(a(De),null,{default:l(()=>[o(a(A),{value:n.cover,"onUpdate:value":t[4]||(t[4]=s=>n.cover=s),placeholder:"分类封面地址",maxlength:"256",clearable:""},null,8,["value"]),o(a(we),null,{trigger:l(()=>[o(a(D),{onClick:t[5]||(t[5]=s=>E.value=!0)},{icon:l(()=>[o(a(S),null,{default:l(()=>[o(a(Se))]),_:1})]),_:1})]),default:l(()=>[t[7]||(t[7]=B("span",null,"查看附件",-1))]),_:1})]),_:1}),n.cover?(f(),U(a(Ee),{key:0,width:380,"object-fit":"cover",src:a(be)(n.cover)},null,8,["src"])):w("",!0)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title","positive-text","loading"]),o(Ce,{"data-count":k.value,"show-empty-status":u.value!==null&&u.value.length===0,"current-page":g.value,"page-size":m.value,"page-count":I.value,"current-page-item-count":((p=u.value)==null?void 0:p.length)??0,"show-pagination":"","item-string":"分类",onOnPageUpdate:X,onOnPageSizeUpdate:ee,"show-checkbox":"",onOnChecked:oe,onOnCheckboxCancel:le,"is-checked":r.value.length===((R=u.value)==null?void 0:R.length)&&u.value.length!==0,"show-delete-button":r.value.length>0,onOnDeleteButtonClick:H},{"header-extra":l(()=>[o(a(D),{type:"primary",onClick:J},{icon:l(()=>[o(a(S),null,{default:l(()=>[o(a(Be))]),_:1})]),default:l(()=>[a(b).isSmallWindow?w("",!0):(f(),N("span",Ze,"添加分类"))]),_:1})]),content:l(()=>[o(a(Ae),{hoverable:""},{default:l(()=>[(f(!0),N(xe,null,Ue(u.value,s=>(f(),U(We,{key:s.categoryId,category:s,onOnDeleteCategory:j,onOnEditCategory:O,"is-checked":r.value.includes(s.categoryId),onOnChecked:ae,onOnUnChecked:te},null,8,["category","is-checked"]))),128))]),_:1})]),_:1},8,["data-count","show-empty-status","current-page","page-size","page-count","current-page-item-count","is-checked","show-delete-button"])])}}});export{Xe as default};
