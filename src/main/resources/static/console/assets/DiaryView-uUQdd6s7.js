import{aB as T,d as F,D as Y,n as z,o as f,w as n,a as o,u as a,F as ae,B as M,c as S,p as w,G as b,H as te,T as ne,M as le,b as $,J as B,k as oe,X as ie,Y as re,_ as se,f as s,br as C,g as de,h as ue,$ as P,a0 as ce,a1 as ve,aE as he,t as De,A as pe,x as ye,m as me,a5 as _e,Q as ge,U as fe,P as Ee,a2 as Ce,a6 as Ie,a8 as R,s as A}from"./index-C97z5PQV.js";import{N as ke}from"./ButtonGroup-crtXYHAe.js";var h=(i=>(i.CREATE_TIME_DESC="CREATE_TIME_DESC",i.CREATE_TIME_ASC="CREATE_TIME_ASC",i.MODIFY_TIME_DESC="MODIFY_TIME_DESC",i.MODIFY_TIME_ASC="MODIFY_TIME_ASC",i))(h||{});function Se(i){return T({url:"/admin/diary",method:"POST",data:{content:i}})}function Te(i){return T({url:"/admin/diary",method:"DELETE",data:i})}function Ae(i,D){return T({url:"/admin/diary",method:"PUT",data:{diaryId:i,content:D}})}function Me(i=null,D=null,p=h.CREATE_TIME_DESC){return T({url:`/admin/diary?page=${i??0}&size=${D??0}&sort=${p}`,method:"GET"})}const we={key:0},be={key:0},Ne=F({__name:"DiaryListItem",props:{diary:{},isChecked:{type:Boolean}},emits:["onEditDiary","onDeleteDiary","onChecked","onUnChecked"],setup(i,{emit:D}){const p=i,y=D,m=Y(),c=t=>{y("onEditDiary",t)},I=t=>{y("onDeleteDiary",t)},d=t=>{y(t?"onChecked":"onUnChecked",p.diary)};return(t,_)=>(f(),z(a(re),null,{default:n(()=>[o(a(ae),{class:"animate__animated animate__fadeIn"},{avatar:n(()=>[o(a(ie),{checked:t.isChecked,style:{"margin-left":"-4px"},onUpdateChecked:d},null,8,["checked"])]),header:n(()=>[$(B(a(oe)(t.diary.createTime)),1)]),description:n(()=>[o(a(le),{depth:"2"},{default:n(()=>[$(B(t.diary.content),1)]),_:1})]),"header-extra":n(()=>[o(a(ke),{size:"small"},{default:n(()=>[o(a(M),{type:"default",tertiary:"",onClick:_[0]||(_[0]=v=>c(t.diary))},{icon:n(()=>[o(a(b),null,{default:n(()=>[o(a(te))]),_:1})]),default:n(()=>[a(m).isSmallWindow?w("",!0):(f(),S("span",we,"编辑"))]),_:1}),o(a(M),{type:"error",tertiary:"",onClick:_[1]||(_[1]=v=>I(t.diary))},{icon:n(()=>[o(a(b),null,{default:n(()=>[o(a(ne))]),_:1})]),default:n(()=>[a(m).isSmallWindow?w("",!0):(f(),S("span",be,"删除"))]),_:1})]),_:1})]),_:1})]),_:1}))}}),xe=se(Ne,[["__scopeId","data-v-d21038b9"]]),Oe={class:"container"},Ue={key:0},Pe=F({__name:"DiaryView",setup(i){const D=Y(),p=s(0),y=s(0),m=s(1),c=s(10),I=s(h.CREATE_TIME_DESC),d=s(null),t=s(Array()),_=s(null),v=s(!1),E=s(!1),k=s(C.ADD),r=de({diaryId:-1,content:"",html:"",createTime:-1,lastModifyTime:-1}),L=[{label:"创建时间降序",value:h.CREATE_TIME_DESC},{label:"创建时间升序",value:h.CREATE_TIME_ASC},{label:"修改时间降序",value:h.MODIFY_TIME_DESC},{label:"修改时间升序",value:h.MODIFY_TIME_ASC}];ue(()=>{G(),g()});const G=()=>{let e=Number(localStorage.getItem(P.DIARY_PAGE_SIZE.toString())??10);isNaN(e)||e<10||e>120?c.value=10:c.value=e},g=()=>{window.$loadingBar.start(),Me(m.value,c.value,I.value??h.CREATE_TIME_DESC).then(e=>{window.$loadingBar.finish();let l=e.data;m.value=l.page,c.value=l.size,p.value=l.totalData,y.value=l.totalPages,d.value=l.data}).catch(()=>{window.$loadingBar.error()})},V=e=>{m.value=e,g()},W=e=>{c.value=e,localStorage.setItem(P.DIARY_PAGE_SIZE.toString(),e.toString()),g()},Z=e=>{R("确定要删除当前日常吗？",()=>{x([e.diaryId])})},N=()=>{r.diaryId=-1,r.content="",r.html="",r.createTime=-1,r.lastModifyTime=-1},q=e=>{N(),k.value=C.EDIT,r.diaryId=e.diaryId,r.content=e.content,v.value=!0},H=e=>{t.value.push(e.diaryId)},J=e=>{t.value=t.value.filter(l=>l!==e.diaryId)},K=()=>{var e;t.value=[],(e=d.value)==null||e.forEach(l=>{t.value.push(l.diaryId)})},Q=()=>{t.value=[]},X=()=>{let e=Array();t.value.forEach(l=>{e.push(l)}),R(`确定要删除选择的 ${e.length} 个日常吗？`,()=>{x(e)})},x=e=>{Te(e).then(()=>{A("删除成功"),t.value=t.value.filter(l=>!e.includes(l)),g()}).catch(()=>{})},j=()=>{var e;return(e=_.value)==null||e.validate(l=>{l||(E.value=!0,k.value==C.ADD?Se(r.content).then(()=>{A("添加成功"),g(),v.value=!1,E.value=!1}).catch(()=>{E.value=!1}):Ae(r.diaryId,r.content).then(()=>{A("修改成功"),g(),v.value=!1,E.value=!1}).catch(()=>{E.value=!1}))}),!1},ee=()=>{N(),k.value=C.ADD,v.value=!0};return(e,l)=>{var O,U;return f(),S("div",Oe,[o(a(ce),{show:v.value,"onUpdate:show":l[1]||(l[1]=u=>v.value=u),preset:"dialog",title:k.value==a(C).ADD?"添加日常":"编辑日常","positive-text":k.value==a(C).ADD?"添加":"保存","negative-text":"取消",loading:E.value,onPositiveClick:j},{default:n(()=>[o(a(he),{style:{"max-height":"65vh","padding-right":"12px"}},{default:n(()=>[o(a(De),{ref_key:"diaryDialogRef",ref:_,model:r,style:{margin:"0 5px"}},{default:n(()=>[o(a(pe),{path:"content",rule:{required:!0,message:"请输入日常内容"}},{default:n(()=>[o(a(ye),{value:r.content,"onUpdate:value":l[0]||(l[0]=u=>r.content=u),placeholder:"请输入日常内容（支持 Markdown）",type:"textarea"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title","positive-text","loading"]),o(ve,{"data-count":p.value,"show-empty-status":d.value!==null&&d.value.length===0,"current-page":m.value,"page-size":c.value,"page-count":y.value,"current-page-item-count":((O=d.value)==null?void 0:O.length)??0,"is-checked":t.value.length===((U=d.value)==null?void 0:U.length)&&d.value.length!==0,"show-pagination":"","show-checkbox":"","show-delete-button":t.value.length>0,"item-string":"日常",onOnPageUpdate:V,onOnPageSizeUpdate:W,onOnChecked:K,onOnCheckboxCancel:Q,onOnDeleteButtonClick:X},{"header-extra":n(()=>[o(a(Ee),null,{default:n(()=>[o(a(Ce),{options:L,value:I.value,"onUpdate:value":[l[2]||(l[2]=u=>I.value=u),g],placeholder:"排序方式",style:{width:"130px"}},null,8,["value"]),o(a(M),{type:"primary",onClick:ee},{icon:n(()=>[o(a(b),null,{default:n(()=>[o(a(Ie))]),_:1})]),default:n(()=>[a(D).isSmallWindow?w("",!0):(f(),S("span",Ue,"添加日常"))]),_:1})]),_:1})]),content:n(()=>[me("div",null,[o(a(_e),{hoverable:""},{default:n(()=>[(f(!0),S(ge,null,fe(d.value,u=>(f(),z(xe,{key:u.diaryId,diary:u,"is-checked":t.value.includes(u.diaryId),onOnDeleteDiary:Z,onOnEditDiary:q,onOnChecked:H,onOnUnChecked:J},null,8,["diary","is-checked"]))),128))]),_:1})])]),_:1},8,["data-count","show-empty-status","current-page","page-size","page-count","current-page-item-count","is-checked","show-delete-button"])])}}});export{Pe as default};
