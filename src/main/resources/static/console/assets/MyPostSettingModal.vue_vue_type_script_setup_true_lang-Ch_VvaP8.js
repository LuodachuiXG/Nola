import{d as I,c as S,m as d,o as v,aB as p,aC as J,aD as pe,f as m,g as ce,h as fe,E as ge,Q as me,a as r,ar as ve,u as n,a0 as he,w as s,a9 as we,aA as xe,j as Q,aE as ke,t as ye,A as g,x as b,a3 as L,V as $,B as M,G as B,J as be,n as A,a2 as q,P as K,p as W,I as Ce,aF as Pe,aG as Ee,M as H,b as Ie,at as G,aH as z,aI as X,a7 as C,aJ as Se}from"./index-CyEZChOx.js";import{c as Te,a as De}from"./categoryApi-62SyA9xG.js";import{t as Ne,a as Ue,_ as Le}from"./tagApi-CjKpR3h7.js";import{R as $e}from"./RefreshOutline-CV2xa80A.js";import{N as Me}from"./Divider-CP5bm5cv.js";const Be={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ae=I({name:"FlashOffOutline",render:function(i,u){return v(),S("svg",Be,u[0]||(u[0]=[d("path",{d:"M432 448a15.92 15.92 0 0 1-11.31-4.69l-352-352a16 16 0 0 1 22.62-22.62l352 352A16 16 0 0 1 432 448z",fill:"currentColor"},null,-1),d("path",{d:"M294.34 84.28l-22.08 120.84a16 16 0 0 0 6.17 15.71a16.49 16.49 0 0 0 9.93 3.17h94.12l-38.37 47.42a4 4 0 0 0 .28 5.34l17.07 17.07a4 4 0 0 0 5.94-.31l60.8-75.16a16.37 16.37 0 0 0 3.3-14.36a16 16 0 0 0-15.5-12H307.19L335.4 37.63c.05-.3.1-.59.13-.89A18.45 18.45 0 0 0 302.73 23l-92.58 114.46a4 4 0 0 0 .28 5.35l17.07 17.06a4 4 0 0 0 5.94-.31z",fill:"currentColor"},null,-1),d("path",{d:"M217.78 427.57l22-120.71a16 16 0 0 0-6.19-15.7a16.54 16.54 0 0 0-9.92-3.16h-94.1l38.36-47.42a4 4 0 0 0-.28-5.34l-17.07-17.07a4 4 0 0 0-5.93.31L83.8 293.64A16.37 16.37 0 0 0 80.5 308A16 16 0 0 0 96 320h108.83l-28.09 154.36v.11a18.37 18.37 0 0 0 32.5 14.53l92.61-114.46a4 4 0 0 0-.28-5.35l-17.07-17.06a4 4 0 0 0-5.94.31z",fill:"currentColor"},null,-1)]))}}),Ge={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Fe=I({name:"FlashOutline",render:function(i,u){return v(),S("svg",Ge,u[0]||(u[0]=[d("path",{d:"M315.27 33L96 304h128l-31.51 173.23a2.36 2.36 0 0 0 2.33 2.77h0a2.36 2.36 0 0 0 1.89-.95L416 208H288l31.66-173.25a2.45 2.45 0 0 0-2.44-2.75h0a2.42 2.42 0 0 0-1.95 1z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1)]))}}),Oe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Re=I({name:"LockOpenOutline",render:function(i,u){return v(),S("svg",Oe,u[0]||(u[0]=[d("path",{d:"M336 112a80 80 0 0 0-160 0v96",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),d("rect",{x:"96",y:"208",width:"320",height:"272",rx:"48",ry:"48",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1)]))}}),He={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ke=I({name:"RocketOutline",render:function(i,u){return v(),S("svg",He,u[0]||(u[0]=[d("path",{d:"M461.81 53.81a4.4 4.4 0 0 0-3.3-3.39c-54.38-13.3-180 34.09-248.13 102.17a294.9 294.9 0 0 0-33.09 39.08c-21-1.9-42-.3-59.88 7.5c-50.49 22.2-65.18 80.18-69.28 105.07a9 9 0 0 0 9.8 10.4l81.07-8.9a180.29 180.29 0 0 0 1.1 18.3a18.15 18.15 0 0 0 5.3 11.09l31.39 31.39a18.15 18.15 0 0 0 11.1 5.3a179.91 179.91 0 0 0 18.19 1.1l-8.89 81a9 9 0 0 0 10.39 9.79c24.9-4 83-18.69 105.07-69.17c7.8-17.9 9.4-38.79 7.6-59.69a293.91 293.91 0 0 0 39.19-33.09c68.38-68 115.47-190.86 102.37-247.95zM298.66 213.67a42.7 42.7 0 1 1 60.38 0a42.65 42.65 0 0 1-60.38 0z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),d("path",{d:"M109.64 352a45.06 45.06 0 0 0-26.35 12.84C65.67 382.52 64 448 64 448s65.52-1.67 83.15-19.31A44.73 44.73 0 0 0 160 402.32",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1)]))}});var P=(o=>(o.PUBLISHED="PUBLISHED",o.DRAFT="DRAFT",o.DELETED="DELETED",o))(P||{}),E=(o=>(o.VISIBLE="VISIBLE",o.HIDDEN="HIDDEN",o))(E||{});function We(o){return p({url:"/admin/post",method:"POST",data:o})}function Xe(o){return p({url:"/admin/post",method:"DELETE",data:o})}function Ye(o){return p({url:"/admin/post/recycle",method:"PUT",data:o})}function Ze(o,i){return p({url:`/admin/post/restore/${i}`,method:"PUT",data:o})}function ze(o){return p({url:"/admin/post",method:"PUT",data:o})}function _e(o,i=null,u=null,h=null){return p({url:"/admin/post/status",method:"PUT",data:{postId:o,status:i,visible:u,pinned:h}})}function et(o=0,i=0,u,h,k,w,y,t){let c=`/admin/post?page=${o}&size=${i}`;return u&&(c+=`&status=${u}`),h&&(c+=`&visible=${h}`),k&&(c+=`&key=${k}`),w&&(c+=`&tag=${w}`),y&&(c+=`&category=${y}`),t&&(c+=`&sort=${t}`),p({url:c,method:"GET"})}function tt(o){return p({url:`/admin/post/${o}`,method:"GET"})}function lt(o){return p({url:`/admin/post/content/${o}`,method:"GET"})}function at(o,i){return p({url:"/admin/post/publish",method:"PUT",data:{postId:o,content:i}})}function nt(o){return p({url:`/admin/post/publish/${o}`,method:"GET"})}function ot(o,i,u){return p({url:"/admin/post/draft",method:"POST",data:{postId:o,content:i,draftName:u}})}function rt(o,i){return p({url:`/admin/post/draft/${o}`,method:"DELETE",data:i})}function st(o,i,u){return p({url:"/admin/post/draft",method:"PUT",data:{postId:o,content:i,draftName:u}})}function ut(o,i,u){return p({url:"/admin/post/draft/name",method:"PUT",data:{postId:o,oldName:i,newName:u}})}function it(o,i,u=!1,h){return p({url:"/admin/post/draft/publish",method:"PUT",data:{postId:o,draftName:i,deleteContent:u,contentName:h}})}function dt(o,i){return p({url:`/admin/post/${o}/draft/${i}`,method:"GET"})}const pt=I({__name:"MyPostSettingModal",props:J({post:{}},{show:{required:!0,type:Boolean,default:!1},showModifiers:{}}),emits:J(["onPostUpdate","onCancel"],["update:show"]),setup(o,{emit:i}){const u=pe(o,"show"),h=o,k=i,w=m(!1),y=m(null),t=ce({postId:-1,title:"",autoGenerateExcerpt:!1,excerpt:"",slug:"",cover:"",allowComment:!1,pinned:!1,status:P.PUBLISHED,visible:E.VISIBLE,password:"",encrypted:!1,lastModifyTime:null,category:null,tags:[],visit:0,createTime:0}),c=m(Array()),x=m(),T=m(Array()),D=m(Array()),N=m(Array()),U=m(Array()),F=m(!1);fe(()=>{V(),j(),ge(u,l=>{l&&Y(h.post)})});const Y=l=>{var a;if(l===null)return;Z(),t.postId=l.postId,t.title=l.title,t.autoGenerateExcerpt=l.autoGenerateExcerpt,t.excerpt=l.excerpt,t.slug=l.slug,t.cover=l.cover,t.allowComment=l.allowComment,t.pinned=l.pinned,t.status=l.status,t.visible=l.visible,t.password=l.password,t.encrypted=l.encrypted,t.lastModifyTime=l.lastModifyTime;let e=Array();l.tags.forEach(f=>{e.push(f.tagId)}),c.value=e,x.value=(a=l.category)==null?void 0:a.categoryId},V=()=>{Ne(0,0).then(l=>{T.value=l.data.data,O(T.value)}).catch(()=>{})},O=(l,e=!0)=>{let a=Array();l.forEach(f=>{a.push({label:f.displayName,value:f.tagId,color:f.color})}),e?D.value=a:D.value.push(...a)},j=()=>{Te(0,0).then(l=>{N.value=l.data.data,R(N.value)}).catch(()=>{})},R=(l,e=!0)=>{let a=Array();l.forEach(f=>{a.push({label:f.displayName,value:f.categoryId})}),e?U.value=a:U.value.push(...a)},Z=()=>{t.postId=-1,t.title="",t.autoGenerateExcerpt=!1,t.excerpt="",t.slug="",t.cover="",t.allowComment=!0,t.pinned=!1,t.status=P.PUBLISHED,t.visible=E.VISIBLE,t.password="",t.encrypted=!1,t.lastModifyTime=null,x.value=void 0,c.value=Array()},_=()=>{if(t.title.length===0){Q("文章标题为空");return}t.slug=z(t.title)},ee=()=>{t.autoGenerateExcerpt=!t.autoGenerateExcerpt},te=l=>{if(l!==null){if(X(l)){x.value=Number(l);return}De({displayName:l,slug:z(l),cover:null,unifiedCover:!1}).then(e=>{let a=e.data;x.value=a.categoryId,j()}).catch(()=>{})}},le=l=>{if(!l.length){R(N.value);return}let e=N.value.filter(a=>{if(a.displayName.toLowerCase().includes(l.toLowerCase()))return!0});if(e.length===0){U.value=[{label:`添加 [${l}] 分类`,value:l}];return}R(e)},ae=l=>{if(l.length===0){c.value=[];return}let e=Array();l.forEach(a=>{X(a)?e.push(Number(a)):Ue({displayName:a,slug:z(a),color:null}).then(f=>{let de=f.data;c.value.push(de.tagId),V()}).catch(()=>{})}),c.value=e},ne=l=>{if(!l.length){O(T.value);return}let e=T.value.filter(a=>{if(a.displayName.toLowerCase().includes(l.toLowerCase()))return!0});if(e.length===0){D.value=[{label:l,value:l,addTag:!0}];return}O(e)},oe=({option:l,handleClose:e})=>{let a={textColor:l.color,borderColor:l.color};return C(Se,{closable:!0,color:a,class:l.color?"tag-text-shadow":"",themeOverrides:{closeIconColor:l.color},onMousedown:f=>{f.preventDefault()},onClose:f=>{f.stopPropagation(),e()}},{default:()=>l.label})},re=l=>{let e="",a="";return l.addTag&&(e="添加",a="标签"),[C(K,{},{default:()=>[e.length===0?null:C(H,{},{default:()=>e}),C(Le,{tag:{displayName:l.label,slug:l.label,color:l.color},size:"small",pointer:!0}),a.length===0?null:C(H,{},{default:()=>a})]})]},se=()=>{var l;return(l=y.value)==null||l.validate(e=>{if(!e){w.value=!0;let a;(t.password===null||t.password.length===0)&&t.encrypted?a=null:a=!!(t.password&&!t.encrypted);let f={postId:t.postId,title:t.title,autoGenerateExcerpt:t.autoGenerateExcerpt,excerpt:t.excerpt,slug:t.slug,cover:t.cover,allowComment:t.allowComment,pinned:t.pinned,status:t.status,visible:t.visible,encrypted:a,password:t.password,categoryId:x.value??null,tagIds:c.value,content:null};ze(f).then(()=>{k("onPostUpdate"),we(),ue()}).catch(()=>{w.value=!1})}}).catch(()=>{}),!1},ue=()=>{w.value=!1,u.value=!1},ie=l=>{let e=l[0];if(!xe(e.displayName)){Q("只能选择图片文件");return}t.cover=e.url};return(l,e)=>(v(),S(me,null,[r(ve,{show:F.value,"onUpdate:show":e[0]||(e[0]=a=>F.value=a),multiple:!1,onOnConfirm:ie},null,8,["show"]),r(n(he),{show:u.value,"onUpdate:show":e[14]||(e[14]=a=>u.value=a),preset:"dialog",title:"文章设置","positive-text":"保存","negative-text":"取消",loading:w.value,onPositiveClick:se,onClose:e[15]||(e[15]=a=>k("onCancel")),"close-on-esc":!1},{default:s(()=>[d("div",null,[r(n(ke),{style:{"max-height":"70vh","padding-right":"12px"}},{default:s(()=>[r(n(ye),{ref_key:"settingPostDialogRef",ref:y,class:"dialog-form",model:t,style:{margin:"10px 5px"}},{default:s(()=>[r(n(g),{label:"标题",path:"title",rule:{required:!0,message:"请输入文章标题"}},{default:s(()=>[r(n(b),{value:t.title,"onUpdate:value":e[1]||(e[1]=a=>t.title=a),placeholder:"文章标题",maxlength:"256",clearable:""},null,8,["value"])]),_:1}),r(n(g),{label:"别名",path:"slug",rule:{required:!0,message:"请输入文章别名"}},{default:s(()=>[r(n(L),null,{default:s(()=>[r(n(b),{value:t.slug,"onUpdate:value":e[2]||(e[2]=a=>t.slug=a),placeholder:"文章别名",maxlength:"256",clearable:""},null,8,["value"]),r(n($),null,{trigger:s(()=>[r(n(M),{onClick:_},{icon:s(()=>[r(n(B),null,{default:s(()=>[r(n($e))]),_:1})]),_:1})]),default:s(()=>[e[16]||(e[16]=d("span",null,"根据标题自动生成",-1))]),_:1})]),_:1})]),_:1}),r(n(g),{label:"摘要",path:"excerpt"},{default:s(()=>[r(n(L),null,{default:s(()=>[r(n(b),{value:t.excerpt,"onUpdate:value":e[3]||(e[3]=a=>t.excerpt=a),placeholder:t.autoGenerateExcerpt?"根据文章内容自动生成":"文章摘要",maxlength:"512",clearable:"",disabled:t.autoGenerateExcerpt},null,8,["value","placeholder","disabled"]),r(n($),null,{trigger:s(()=>[r(n(M),{onClick:ee},{icon:s(()=>[r(n(B),null,{default:s(()=>[t.autoGenerateExcerpt?(v(),A(n(Fe),{key:0})):(v(),A(n(Ae),{key:1}))]),_:1})]),_:1})]),default:s(()=>[d("span",null,be(t.autoGenerateExcerpt?"根据文章内容自动生成":"手动填写"),1)]),_:1})]),_:1})]),_:1}),r(n(g),{label:"分类",path:"category"},{default:s(()=>[r(n(q),{options:U.value,value:x.value,"onUpdate:value":te,onSearch:le,onClear:e[4]||(e[4]=a=>x.value=void 0),filterable:"",tag:"",remote:"",clearable:""},null,8,["options","value"])]),_:1}),r(n(g),{label:"标签",path:"tag"},{default:s(()=>[r(n(q),{options:D.value,value:c.value,"onUpdate:value":ae,onSearch:ne,onClear:e[5]||(e[5]=a=>c.value=Array()),"render-tag":oe,"render-label":re,multiple:"",filterable:"",tag:"",remote:"",clearable:""},null,8,["options","value"])]),_:1}),r(n(g),{label:"封面",path:"cover"},{default:s(()=>[r(n(K),{vertical:"",style:{width:"100%"}},{default:s(()=>[r(n(L),null,{default:s(()=>[r(n(b),{value:t.cover,"onUpdate:value":e[6]||(e[6]=a=>t.cover=a),placeholder:"文章封面地址",maxlength:"256",clearable:""},null,8,["value"]),r(n($),null,{trigger:s(()=>[r(n(M),{onClick:e[7]||(e[7]=a=>F.value=!0)},{icon:s(()=>[r(n(B),null,{default:s(()=>[r(n(Ce))]),_:1})]),_:1})]),default:s(()=>[e[17]||(e[17]=d("span",null,"查看附件",-1))]),_:1})]),_:1}),t.cover?(v(),A(n(Ee),{key:0,width:380,"object-fit":"cover",src:n(Pe)(t.cover)},null,8,["src"])):W("",!0)]),_:1})]),_:1}),r(n(Me),null,{default:s(()=>[r(n(H),{depth:"3",style:{"font-size":"0.9em"}},{default:s(()=>e[18]||(e[18]=[Ie("进阶设置")])),_:1})]),_:1}),r(n(g),{label:"密码",path:"password"},{default:s(()=>[r(n(L),null,{default:s(()=>[r(n(b),{value:t.password,"onUpdate:value":e[8]||(e[8]=a=>t.password=a),placeholder:t.encrypted?"文章已设置密码":"文章密码",maxlength:"128",clearable:"",disabled:t.encrypted},null,8,["value","placeholder","disabled"]),t.encrypted?(v(),A(n($),{key:0},{trigger:s(()=>[r(n(M),{onClick:e[9]||(e[9]=a=>t.encrypted=!1)},{icon:s(()=>[r(n(B),null,{default:s(()=>[r(n(Re))]),_:1})]),_:1})]),default:s(()=>[e[19]||(e[19]=d("span",null,"解锁文章",-1))]),_:1})):W("",!0)]),_:1})]),_:1}),r(n(g),{label:"评论",path:"allowComment"},{default:s(()=>[r(n(G),{value:t.allowComment,"onUpdate:value":e[10]||(e[10]=a=>t.allowComment=a)},{checked:s(()=>e[20]||(e[20]=[d("span",null,"允许评论",-1)])),unchecked:s(()=>e[21]||(e[21]=[d("span",null,"禁止评论",-1)])),_:1},8,["value"])]),_:1}),r(n(g),{label:"置顶",path:"pinned"},{default:s(()=>[r(n(G),{value:t.pinned,"onUpdate:value":e[11]||(e[11]=a=>t.pinned=a)},{checked:s(()=>e[22]||(e[22]=[d("span",null,"置顶文章",-1)])),unchecked:s(()=>e[23]||(e[23]=[d("span",null,"默认文章",-1)])),_:1},8,["value"])]),_:1}),r(n(g),{label:"状态",path:"status"},{default:s(()=>[r(n(G),{value:t.status,"onUpdate:value":e[12]||(e[12]=a=>t.status=a),"checked-value":n(P).PUBLISHED,"unchecked-value":n(P).DRAFT},{checked:s(()=>e[24]||(e[24]=[d("span",null,"已发布",-1)])),unchecked:s(()=>e[25]||(e[25]=[d("span",null,"草稿",-1)])),_:1},8,["value","checked-value","unchecked-value"])]),_:1}),r(n(g),{label:"可见性",path:"visible"},{default:s(()=>[r(n(G),{value:t.visible,"onUpdate:value":e[13]||(e[13]=a=>t.visible=a),"checked-value":n(E).VISIBLE,"unchecked-value":n(E).HIDDEN},{checked:s(()=>e[26]||(e[26]=[d("span",null,"可见",-1)])),unchecked:s(()=>e[27]||(e[27]=[d("span",null,"隐藏",-1)])),_:1},8,["value","checked-value","unchecked-value"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1},8,["show","loading"])],64))}});export{P,pt as _,Ke as a,E as b,Ze as c,Xe as d,tt as e,nt as f,lt as g,at as h,st as i,We as j,rt as k,dt as l,ut as m,ot as n,it as o,et as p,Ye as r,_e as u};
