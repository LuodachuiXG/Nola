import{d as h,e as j,f as p,g as U,h as P,i as $,s as b,j as G,l as H,k as J,r as O,R as Q,c as W,m as z,n as A,p as K,q as X,w as s,u as a,t as L,v as Y,a as l,x as u,y as d,z as i,A as n,B as q,b as I,o as k,_ as Z}from"./index-CyEZChOx.js";import{g as c,i as _,c as ee}from"./blogApi-DBlDTydZ.js";const ae=h({__name:"LoginView",setup(le){const C=j(),m=p(0),B=p(),R=p(null),f=U({username:"",password:""}),g=p(!1),S=p(null),v=U({title:"",subtitle:""}),w=p(!1),V=p(null),r=U({username:"",displayName:"",email:"",password:"",passwordA:""}),y=p(!1);P(()=>{N(),document.addEventListener("keydown",x)}),$(()=>{document.removeEventListener("keydown",x)});function x(o){if(o.key==="Enter")switch(m.value){case 0:E();break;case 2:F();break;case 1:M();break}}const N=()=>{c().then(o=>{var e;B.value=o.data,B.value===null?m.value=1:((e=B.value)==null?void 0:e.blogger)===null?m.value=2:m.value=0}).catch(()=>{})},M=()=>{var o;(o=S.value)==null||o.validate(e=>{e||(w.value=!0,_(v.title,v.subtitle).then(()=>{b("博客初始化成功"),N(),w.value=!1}).catch(()=>{w.value=!1}))}).catch(()=>{})},F=()=>{var o;(o=V.value)==null||o.validate(e=>{e||(y.value=!0,ee(r.username,r.displayName,r.email,r.password).then(t=>{t.data?(b("管理员创建成功"),N()):G("创建管理员失败，请查看后台日志"),y.value=!1}).catch(()=>{y.value=!1}))}).catch(()=>{})},E=()=>{var o;(o=R.value)==null||o.validate(e=>{e||(g.value=!0,H(f.username,f.password).then(t=>{var D;C.login(t.data),(D=C.getUser)!=null&&D.lastLoginDate?b(`上次登录时间：${J(C.getUser.lastLoginDate)}`):b("欢迎使用 Nola 博客 ^_^"),O.push(Q.MAIN.name),g.value=!1}).catch(()=>{g.value=!1}))}).catch(()=>{})},T=(o,e)=>e===r.password;return(o,e)=>(k(),W("div",{class:"container",style:Y(m.value===2?"margin-top:0;":"")},[e[21]||(e[21]=z("img",{class:"logo",src:X,alt:"Nola"},null,-1)),e[22]||(e[22]=z("br",null,null,-1)),m.value===0?(k(),A(a(L),{key:0,ref_key:"formLoginRef",ref:R,class:"form",model:f,"show-label":!1},{default:s(()=>[l(a(n),{path:"username",rule:{required:!0,message:"请输入用户名"}},{default:s(()=>[l(a(u),{value:f.username,"onUpdate:value":e[0]||(e[0]=t=>f.username=t),placeholder:"用户名",onKeydown:e[1]||(e[1]=d(i(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1}),l(a(n),{path:"password",rule:{required:!0,message:"请输入密码"}},{default:s(()=>[l(a(u),{value:f.password,"onUpdate:value":e[2]||(e[2]=t=>f.password=t),placeholder:"密码",type:"password","show-password-on":"click",onKeydown:e[3]||(e[3]=d(i(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1}),l(a(n),null,{default:s(()=>[l(a(q),{type:"primary",onClick:E,style:{width:"100%"},loading:g.value},{default:s(()=>e[18]||(e[18]=[I("登录 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])):K("",!0),m.value===1?(k(),A(a(L),{key:1,ref_key:"formCreateBlogRef",ref:S,class:"form",model:v,"show-label":!1},{default:s(()=>[l(a(n),{path:"title",rule:{required:!0,message:"请输入站点标题"}},{default:s(()=>[l(a(u),{value:v.title,"onUpdate:value":e[4]||(e[4]=t=>v.title=t),placeholder:"站点标题",onKeydown:e[5]||(e[5]=d(i(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1}),l(a(n),{path:"subtitle"},{default:s(()=>[l(a(u),{value:v.subtitle,"onUpdate:value":e[6]||(e[6]=t=>v.subtitle=t),placeholder:"站点副标题（可选）",onKeydown:e[7]||(e[7]=d(i(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1}),l(a(n),null,{default:s(()=>[l(a(q),{type:"primary",onClick:M,style:{width:"100%"},loading:w.value},{default:s(()=>e[19]||(e[19]=[I(" 初始化博客 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])):K("",!0),m.value===2?(k(),A(a(L),{key:2,ref_key:"formCreateAdminRef",ref:V,class:"form",model:r,"show-label":!1},{default:s(()=>[l(a(n),{path:"username",rule:[{required:!0,message:"请输入用户名"},{min:4,message:"用户名不能小于 4 位",trigger:"blur"}]},{default:s(()=>[l(a(u),{value:r.username,"onUpdate:value":e[8]||(e[8]=t=>r.username=t),placeholder:"用户名",onKeydown:e[9]||(e[9]=d(i(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1}),l(a(n),{path:"displayName",rule:{required:!0,message:"请输入显示名称"}},{default:s(()=>[l(a(u),{value:r.displayName,"onUpdate:value":e[10]||(e[10]=t=>r.displayName=t),placeholder:"显示名称",onKeydown:e[11]||(e[11]=d(i(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1}),l(a(n),{path:"email",rule:[{required:!0,message:"请输入邮箱"},{type:"email",message:"邮箱不正确",trigger:"blur"}]},{default:s(()=>[l(a(u),{value:r.email,"onUpdate:value":e[12]||(e[12]=t=>r.email=t),placeholder:"邮箱",onKeydown:e[13]||(e[13]=d(i(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1}),l(a(n),{path:"password",rule:[{required:!0,message:"请输入密码"},{min:8,message:"密码不能小于 8 位",trigger:"blur"}]},{default:s(()=>[l(a(u),{value:r.password,"onUpdate:value":e[14]||(e[14]=t=>r.password=t),type:"password","show-password-on":"click",placeholder:"密码",onKeydown:e[15]||(e[15]=d(i(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1}),l(a(n),{path:"passwordA",rule:[{required:!0,message:"请输入密码"},{validator:T,message:"两次密码不一致",trigger:"blur"}]},{default:s(()=>[l(a(u),{value:r.passwordA,"onUpdate:value":e[16]||(e[16]=t=>r.passwordA=t),type:"password","show-password-on":"click",placeholder:"重复密码",onKeydown:e[17]||(e[17]=d(i(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1},8,["rule"]),l(a(n),null,{default:s(()=>[l(a(q),{type:"primary",onClick:F,style:{width:"100%"},loading:y.value},{default:s(()=>e[20]||(e[20]=[I(" 创建管理员 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])):K("",!0)],4))}}),re=Z(ae,[["__scopeId","data-v-e4100ec2"]]);export{re as default};
