import{d as q,D as W,o as f,k as j,w as o,a as l,A as G,u as t,b as M,G as R,N as x,H as U,T as le,c as _,m as B,e as i,f as ne,g as se,S as z,i as k,q as re,ao as de,X as F,j as b,x as ue,v as E,p as S,V as ie,O as ce,P as ge,ax as ve}from"./index-BeAjLgC_.js";import{b as pe,c as me,a as fe,u as he,d as ye}from"./categoryApi-DeTvhClQ.js";import{D as m}from"./DialogFormMode-F5uswgu2.js";import{N as L,T as Ce}from"./TrashOutline-DLK0KsOh.js";import{N as Ne,a as ke,b as _e,c as De,_ as Ie,A as Ee,d as we}from"./MyCard.vue_vue_type_script_setup_true_lang-DGQyIiRj.js";import{N as Ae}from"./Badge-Dfbpssef.js";import{N as be}from"./Switch-IXzFPKcE.js";import"./Result-BUcOHWzf.js";const Se={style:{"margin-right":"-10px"}},xe={key:0},Ue={key:0},Be=q({__name:"CategoryListItem",props:{category:{},isChecked:{type:Boolean}},emits:["onEditCategory","onDeleteCategory","onChecked","onUnChecked"],setup(O,{emit:w}){const u=O,r=W("globalVars"),c=w,h=s=>{c("onEditCategory",s)},D=s=>{c("onDeleteCategory",s)},I=s=>{c(s?"onChecked":"onUnChecked",u.category)};return(s,v)=>(f(),j(t(De),null,{default:o(()=>[l(t(_e),{class:"animate__animated animate__fadeIn"},{avatar:o(()=>[G("div",Se,[l(t(Ne),{checked:s.isChecked,style:{"margin-left":"-4px","margin-right":"12px"},onUpdateChecked:I},null,8,["checked"])])]),header:o(()=>[l(t(Ae),{class:"none-select pointer",value:s.category.postCount??0,offset:[14,0]},{default:o(()=>[G("div",null,[l(t(L),{strong:""},{default:o(()=>[M(R(s.category.displayName),1)]),_:1})])]),_:1},8,["value"])]),description:o(()=>[l(t(L),{depth:"3"},{default:o(()=>[M(R(s.category.slug),1)]),_:1})]),"header-extra":o(()=>[l(t(ke),{size:"small"},{default:o(()=>[l(t(x),{type:"default",tertiary:"",onClick:v[0]||(v[0]=p=>h(s.category))},{icon:o(()=>[l(t(U),null,{default:o(()=>[l(t(le))]),_:1})]),default:o(()=>[t(r).isSmallWindow?B("",!0):(f(),_("span",xe,"设置"))]),_:1}),l(t(x),{type:"error",tertiary:"",onClick:v[1]||(v[1]=p=>D(s.category))},{icon:o(()=>[l(t(U),null,{default:o(()=>[l(t(Ce))]),_:1})]),default:o(()=>[t(r).isSmallWindow?B("",!0):(f(),_("span",Ue,"删除"))]),_:1})]),_:1})]),_:1})]),_:1}))}}),Oe={class:"container"},Ve={key:0},Le=q({__name:"CategoryView",setup(O){const w=W("globalVars"),u=i(null),r=i(Array()),c=i(1),h=i(10),D=i(0),I=i(0),s=i(m.ADD),v=i(null),p=i(!1),N=i(!1),n=ne({categoryId:-1,displayName:"",slug:"",cover:null,unifiedCover:!1}),K=de();se(()=>{h.value=Number(localStorage.getItem(z.CATEGORY_PAGE_SIZE)??10);let e=Number(K.query.categoryId);isNaN(e)||pe(Number(e)).then(a=>{P(a.data)}).catch(a=>k(a)),y()});const y=()=>{window.$loadingBar.start(),me(c.value,h.value).then(e=>{var g;let a=e.data;if(((g=a.data)==null?void 0:g.length)===0&&a.totalData!==0){c.value=1,y();return}u.value=a.data,D.value=a.totalData,I.value=a.totalPages,window.$loadingBar.finish()}).catch(e=>{k(e),window.$loadingBar.error()})},Y=e=>{F("确定要删除分类 ["+(e==null?void 0:e.displayName)+"] 吗？此操作不可逆。",()=>{V([e.categoryId])})},Z=()=>{let e=Array();r.value.forEach(a=>{e.push(a)}),F(`确定要删除选择的 ${e.length} 个分类吗？`,()=>{V(e)})},V=e=>{ye(e).then(()=>{b("删除成功"),r.value=r.value.filter(a=>!e.includes(a)),y()}).catch(a=>{k(a)})},P=e=>{A(),n.categoryId=e.categoryId,n.displayName=e.displayName,n.slug=e.slug,n.cover=e.cover,n.unifiedCover=e.unifiedCover,s.value=m.EDIT,p.value=!0},H=()=>{A(),s.value=m.ADD,p.value=!0},$=()=>{var e;return(e=v.value)==null||e.validate(a=>{if(!a){N.value=!0;let g={categoryId:n.categoryId,displayName:n.displayName,slug:encodeURIComponent(n.slug),cover:n.cover,unifiedCover:n.unifiedCover};s.value===m.ADD?fe(g).then(()=>{b("添加成功"),T()}).catch(C=>{k(C),N.value=!1}):he(g).then(()=>{b("修改成功"),T()}).catch(C=>{k(C),N.value=!1})}}).catch(()=>{}),!1},T=()=>{N.value=!1,p.value=!1,A(),y()},A=()=>{n.categoryId=-1,n.displayName="",n.slug="",n.cover=null,n.unifiedCover=!1},X=e=>{n.displayName=e,s.value===m.ADD&&(n.slug=ve(e))},J=e=>{c.value=e,y()},Q=e=>{h.value=e,localStorage.setItem(z.CATEGORY_PAGE_SIZE,e.toString()),y()},ee=e=>{r.value.push(e.categoryId)},ae=e=>{r.value=r.value.filter(a=>a!==e.categoryId)},te=()=>{var e;r.value=[],(e=u.value)==null||e.forEach(a=>{r.value.push(a.categoryId)})},oe=()=>{r.value=[]};return(e,a)=>{var g,C;return f(),_("div",Oe,[l(t(ie),{show:p.value,"onUpdate:show":a[4]||(a[4]=d=>p.value=d),preset:"dialog",title:s.value==t(m).ADD?"添加分类":"分类设置","positive-text":s.value==t(m).ADD?"添加":"保存","negative-text":"取消",loading:N.value,onPositiveClick:$,onKeydown:re($,["enter"])},{default:o(()=>[l(t(ue),{ref_key:"addEditDialogRef",ref:v,class:"dialog-form",model:n},{default:o(()=>[l(t(E),{label:"分类名",path:"displayName",rule:{required:!0,message:"请输入分类名"}},{default:o(()=>[l(t(S),{"default-value":n.displayName,"onUpdate:defaultValue":a[0]||(a[0]=d=>n.displayName=d),placeholder:"分类名",onUpdateValue:X,maxlength:"50"},null,8,["default-value"])]),_:1}),l(t(E),{label:"分类别名",path:"slug",rule:{required:!0,message:"请输入分类别名"}},{default:o(()=>[l(t(S),{value:n.slug,"onUpdate:value":a[1]||(a[1]=d=>n.slug=d),placeholder:"分类别名",maxlength:"50"},null,8,["value"])]),_:1}),l(t(E),{label:"封面",path:"cover",rule:{type:"url",message:"封面地址有误"}},{default:o(()=>[l(t(S),{value:n.cover,"onUpdate:value":a[2]||(a[2]=d=>n.cover=d),placeholder:"分类封面地址",maxlength:"256"},null,8,["value"])]),_:1}),l(t(E),{label:"统一封面",path:"unifiedCover"},{default:o(()=>[l(t(be),{value:n.unifiedCover,"onUpdate:value":a[3]||(a[3]=d=>n.unifiedCover=d)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title","positive-text","loading"]),l(Ie,{"data-count":D.value,"show-empty-status":u.value!==null&&u.value.length===0,"current-page":c.value,"page-size":h.value,"page-count":I.value,"current-page-item-count":((g=u.value)==null?void 0:g.length)??0,"show-pagination":"","item-string":"分类",onOnPageUpdate:J,onOnPageSizeUpdate:Q,"show-checkbox":"",onOnChecked:te,onOnCheckboxCancel:oe,"is-checked":r.value.length===((C=u.value)==null?void 0:C.length)&&u.value.length!==0,"show-delete-button":r.value.length>0,onOnDeleteButtonClick:Z},{"header-extra":o(()=>[l(t(x),{type:"primary",onClick:H},{icon:o(()=>[l(t(U),null,{default:o(()=>[l(t(Ee))]),_:1})]),default:o(()=>[t(w).isSmallWindow?B("",!0):(f(),_("span",Ve,"添加分类"))]),_:1})]),content:o(()=>[l(t(we),{hoverable:""},{default:o(()=>[(f(!0),_(ce,null,ge(u.value,d=>(f(),j(Be,{key:d.categoryId,category:d,onOnDeleteCategory:Y,onOnEditCategory:P,"is-checked":r.value.includes(d.categoryId),onOnChecked:ee,onOnUnChecked:ae},null,8,["category","is-checked"]))),128))]),_:1})]),_:1},8,["data-count","show-empty-status","current-page","page-size","page-count","current-page-item-count","is-checked","show-delete-button"])])}}});export{Le as default};
