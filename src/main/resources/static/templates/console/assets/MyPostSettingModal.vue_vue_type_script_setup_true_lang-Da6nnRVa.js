import{d as k,o as g,c as I,A as i,s as p,av as W,aw as re,e as v,f as ue,g as ie,E as de,i as x,k as L,w as s,u as o,Y as ce,a as r,x as pe,v as h,p as C,F as U,N as M,H as B,G as fe,U as he,b as ge,m as me,V as ve,ax as H,ay as Y,W as P,M as we}from"./index-BeAjLgC_.js";import{c as _e,a as xe}from"./categoryApi-DeTvhClQ.js";import{t as ke,a as be,_ as ye}from"./tagApi-3Xw9A7Aw.js";import{N as A}from"./InputGroup-BbfXAoJf.js";import{a as q,N as z,b as Ce,c as Pe}from"./TrashOutline-DLK0KsOh.js";import{N as Ee}from"./Divider-DODEea0d.js";import{N as G}from"./Switch-IXzFPKcE.js";const Se={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ie=i("path",{d:"M432 448a15.92 15.92 0 0 1-11.31-4.69l-352-352a16 16 0 0 1 22.62-22.62l352 352A16 16 0 0 1 432 448z",fill:"currentColor"},null,-1),Te=i("path",{d:"M294.34 84.28l-22.08 120.84a16 16 0 0 0 6.17 15.71a16.49 16.49 0 0 0 9.93 3.17h94.12l-38.37 47.42a4 4 0 0 0 .28 5.34l17.07 17.07a4 4 0 0 0 5.94-.31l60.8-75.16a16.37 16.37 0 0 0 3.3-14.36a16 16 0 0 0-15.5-12H307.19L335.4 37.63c.05-.3.1-.59.13-.89A18.45 18.45 0 0 0 302.73 23l-92.58 114.46a4 4 0 0 0 .28 5.35l17.07 17.06a4 4 0 0 0 5.94-.31z",fill:"currentColor"},null,-1),$e=i("path",{d:"M217.78 427.57l22-120.71a16 16 0 0 0-6.19-15.7a16.54 16.54 0 0 0-9.92-3.16h-94.1l38.36-47.42a4 4 0 0 0-.28-5.34l-17.07-17.07a4 4 0 0 0-5.93.31L83.8 293.64A16.37 16.37 0 0 0 80.5 308A16 16 0 0 0 96 320h108.83l-28.09 154.36v.11a18.37 18.37 0 0 0 32.5 14.53l92.61-114.46a4 4 0 0 0-.28-5.35l-17.07-17.06a4 4 0 0 0-5.94.31z",fill:"currentColor"},null,-1),Ne=[Ie,Te,$e],De=k({name:"FlashOffOutline",render:function(u,d){return g(),I("svg",Se,Ne)}}),Le={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ue=i("path",{d:"M315.27 33L96 304h128l-31.51 173.23a2.36 2.36 0 0 0 2.33 2.77h0a2.36 2.36 0 0 0 1.89-.95L416 208H288l31.66-173.25a2.45 2.45 0 0 0-2.44-2.75h0a2.42 2.42 0 0 0-1.95 1z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),Me=[Ue],Be=k({name:"FlashOutline",render:function(u,d){return g(),I("svg",Le,Me)}}),Ae={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ge=i("path",{d:"M336 112a80 80 0 0 0-160 0v96",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),Oe=i("rect",{x:"96",y:"208",width:"320",height:"272",rx:"48",ry:"48",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),Fe=[Ge,Oe],Re=k({name:"LockOpenOutline",render:function(u,d){return g(),I("svg",Ae,Fe)}}),He={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ze=i("path",{d:"M320 146s24.36-12-64-12a160 160 0 1 0 160 160",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-miterlimit":"10","stroke-width":"32"},null,-1),Ve=i("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M256 58l80 80l-80 80"},null,-1),je=[ze,Ve],We=k({name:"RefreshOutline",render:function(u,d){return g(),I("svg",He,je)}}),Ye={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},qe=i("path",{d:"M461.81 53.81a4.4 4.4 0 0 0-3.3-3.39c-54.38-13.3-180 34.09-248.13 102.17a294.9 294.9 0 0 0-33.09 39.08c-21-1.9-42-.3-59.88 7.5c-50.49 22.2-65.18 80.18-69.28 105.07a9 9 0 0 0 9.8 10.4l81.07-8.9a180.29 180.29 0 0 0 1.1 18.3a18.15 18.15 0 0 0 5.3 11.09l31.39 31.39a18.15 18.15 0 0 0 11.1 5.3a179.91 179.91 0 0 0 18.19 1.1l-8.89 81a9 9 0 0 0 10.39 9.79c24.9-4 83-18.69 105.07-69.17c7.8-17.9 9.4-38.79 7.6-59.69a293.91 293.91 0 0 0 39.19-33.09c68.38-68 115.47-190.86 102.37-247.95zM298.66 213.67a42.7 42.7 0 1 1 60.38 0a42.65 42.65 0 0 1-60.38 0z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),Je=i("path",{d:"M109.64 352a45.06 45.06 0 0 0-26.35 12.84C65.67 382.52 64 448 64 448s65.52-1.67 83.15-19.31A44.73 44.73 0 0 0 160 402.32",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),Ke=[qe,Je],mt=k({name:"RocketOutline",render:function(u,d){return g(),I("svg",Ye,Ke)}});var E=(n=>(n.PUBLISHED="PUBLISHED",n.DRAFT="DRAFT",n.DELETED="DELETED",n))(E||{}),S=(n=>(n.VISIBLE="VISIBLE",n.HIDDEN="HIDDEN",n))(S||{});function vt(n){return p({url:"/admin/post",method:"POST",data:n})}function wt(n){return p({url:"/admin/post",method:"DELETE",data:n})}function _t(n){return p({url:"/admin/post/recycle",method:"PUT",data:n})}function xt(n,u){return p({url:`/admin/post/restore/${u}`,method:"PUT",data:n})}function Qe(n){return p({url:"/admin/post",method:"PUT",data:n})}function kt(n,u=null,d=null,m=null){return p({url:"/admin/post/status",method:"PUT",data:{postId:n,status:u,visible:d,pinned:m}})}function bt(n=0,u=0,d,m,b,w,y,e){let f=`/admin/post?page=${n}&size=${u}`;return d&&(f+=`&status=${d}`),m&&(f+=`&visible=${m}`),b&&(f+=`&key=${b}`),w&&(f+=`&tag=${w}`),y&&(f+=`&category=${y}`),e&&(f+=`&sort=${e}`),p({url:f,method:"GET"})}function yt(n){return p({url:`/admin/post/${n}`,method:"GET"})}function Ct(n){return p({url:`/admin/post/content/${n}`,method:"GET"})}function Pt(n,u){return p({url:"/admin/post/publish",method:"PUT",data:{postId:n,content:u}})}function Et(n){return p({url:`/admin/post/publish/${n}`,method:"GET"})}function St(n,u,d){return p({url:"/admin/post/draft",method:"POST",data:{postId:n,content:u,draftName:d}})}function It(n,u){return p({url:`/admin/post/draft/${n}`,method:"DELETE",data:u})}function Tt(n,u,d){return p({url:"/admin/post/draft",method:"PUT",data:{postId:n,content:u,draftName:d}})}function $t(n,u,d){return p({url:"/admin/post/draft/name",method:"PUT",data:{postId:n,oldName:u,newName:d}})}function Nt(n,u,d=!1,m){return p({url:"/admin/post/draft/publish",method:"PUT",data:{postId:n,draftName:u,deleteContent:d,contentName:m}})}function Dt(n,u){return p({url:`/admin/post/${n}/draft/${u}`,method:"GET"})}const Xe=i("span",null,"根据标题自动生成",-1),Ze=i("span",null,"查看附件",-1),et=i("span",null,"解锁文章",-1),tt=i("span",null,"允许评论",-1),lt=i("span",null,"禁止评论",-1),at=i("span",null,"置顶文章",-1),ot=i("span",null,"默认文章",-1),nt=i("span",null,"已发布",-1),st=i("span",null,"草稿",-1),rt=i("span",null,"可见",-1),ut=i("span",null,"隐藏",-1),Lt=k({__name:"MyPostSettingModal",props:W({post:{}},{show:{required:!0,type:Boolean,default:!1},showModifiers:{}}),emits:W(["onPostUpdate","onCancel"],["update:show"]),setup(n,{emit:u}){const d=re(n,"show"),m=n,b=u,w=v(!1),y=v(null),e=ue({postId:-1,title:"",autoGenerateExcerpt:!1,excerpt:"",slug:"",cover:"",allowComment:!1,pinned:!1,status:E.PUBLISHED,visible:S.VISIBLE,password:"",encrypted:!1,lastModifyTime:null,category:null,tags:[],visit:0,createTime:0}),f=v(Array()),_=v(),T=v(Array()),$=v(Array()),N=v(Array()),D=v(Array());ie(()=>{V(),j(),de(d,t=>{t&&J(m.post)})});const J=t=>{var a;if(t===null)return;K(),e.postId=t.postId,e.title=t.title,e.autoGenerateExcerpt=t.autoGenerateExcerpt,e.excerpt=t.excerpt,e.slug=t.slug,e.cover=t.cover,e.allowComment=t.allowComment,e.pinned=t.pinned,e.status=t.status,e.visible=t.visible,e.password=t.password,e.encrypted=t.encrypted,e.lastModifyTime=t.lastModifyTime;let l=Array();t.tags.forEach(c=>{l.push(c.tagId)}),f.value=l,_.value=(a=t.category)==null?void 0:a.categoryId},V=()=>{ke(0,0).then(t=>{T.value=t.data.data,O(T.value)}).catch(t=>x("标签获取失败："+t))},O=(t,l=!0)=>{let a=Array();t.forEach(c=>{a.push({label:c.displayName,value:c.tagId,color:c.color})}),l?$.value=a:$.value.push(...a)},j=()=>{_e(0,0).then(t=>{N.value=t.data.data,F(N.value)}).catch(t=>x("分类获取失败："+t))},F=(t,l=!0)=>{let a=Array();t.forEach(c=>{a.push({label:c.displayName,value:c.categoryId})}),l?D.value=a:D.value.push(...a)},K=()=>{e.postId=-1,e.title="",e.autoGenerateExcerpt=!1,e.excerpt="",e.slug="",e.cover="",e.allowComment=!0,e.pinned=!1,e.status=E.PUBLISHED,e.visible=S.VISIBLE,e.password="",e.encrypted=!1,e.lastModifyTime=null,_.value=void 0,f.value=Array()},Q=()=>{if(e.title.length===0){x("文章标题为空");return}e.slug=H(e.title)},X=()=>{e.autoGenerateExcerpt=!e.autoGenerateExcerpt},Z=t=>{if(t!==null){if(Y(t)){_.value=Number(t);return}xe({displayName:t,slug:H(t),cover:null,unifiedCover:!1}).then(l=>{let a=l.data;_.value=a.categoryId,j()}).catch(l=>x("添加分类失败："+l))}},ee=t=>{if(!t.length){F(N.value);return}let l=N.value.filter(a=>{if(a.displayName.toLowerCase().includes(t.toLowerCase()))return!0});if(l.length===0){D.value=[{label:`添加 [${t}] 分类`,value:t}];return}F(l)},te=t=>{if(t.length===0){f.value=[];return}let l=Array();t.forEach(a=>{Y(a)?l.push(Number(a)):be({displayName:a,slug:H(a),color:null}).then(c=>{let R=c.data;f.value.push(R.tagId),V()}).catch(c=>x("添加标签失败："+c))}),f.value=l},le=t=>{if(!t.length){O(T.value);return}let l=T.value.filter(a=>{if(a.displayName.toLowerCase().includes(t.toLowerCase()))return!0});if(l.length===0){$.value=[{label:t,value:t,addTag:!0}];return}O(l)},ae=({option:t,handleClose:l})=>{let a={textColor:t.color,borderColor:t.color};return P(Pe,{closable:!0,color:a,class:t.color?"tag-text-shadow":"",themeOverrides:{closeIconColor:t.color},onMousedown:c=>{c.preventDefault()},onClose:c=>{c.stopPropagation(),l()}},{default:()=>t.label})},oe=t=>{let l="",a="";return t.addTag&&(l="添加",a="标签"),[P(we,{},{default:()=>[l.length===0?null:P(z,{},{default:()=>l}),P(ye,{tag:{displayName:t.label,slug:t.label,color:t.color},size:"small",pointer:!0}),a.length===0?null:P(z,{},{default:()=>a})]})]},ne=()=>{var t;return(t=y.value)==null||t.validate(l=>{if(!l){w.value=!0;let a;(e.password===null||e.password.length===0)&&e.encrypted?a=null:a=!!(e.password&&!e.encrypted);let c={postId:e.postId,title:e.title,autoGenerateExcerpt:e.autoGenerateExcerpt,excerpt:e.excerpt,slug:e.slug,cover:e.cover,allowComment:e.allowComment,pinned:e.pinned,status:e.status,visible:e.visible,encrypted:a,password:e.password,categoryId:_.value??null,tagIds:f.value,content:null};Qe(c).then(()=>{b("onPostUpdate"),ce(),se()}).catch(R=>{w.value=!1,x(R)})}}).catch(()=>{}),!1},se=()=>{w.value=!1,d.value=!1};return(t,l)=>(g(),L(o(ve),{show:d.value,"onUpdate:show":l[13]||(l[13]=a=>d.value=a),preset:"dialog",title:"文章设置","positive-text":"保存","negative-text":"取消",loading:w.value,onPositiveClick:ne,onClose:l[14]||(l[14]=a=>b("onCancel")),"close-on-esc":!1,"mask-closable":!1},{default:s(()=>[i("div",null,[r(o(Ce),{style:{"max-height":"70vh","padding-right":"12px"}},{default:s(()=>[r(o(pe),{ref_key:"settingPostDialogRef",ref:y,class:"dialog-form",model:e,style:{margin:"10px 5px"}},{default:s(()=>[r(o(h),{label:"标题",path:"title",rule:{required:!0,message:"请输入文章标题"}},{default:s(()=>[r(o(C),{value:e.title,"onUpdate:value":l[0]||(l[0]=a=>e.title=a),placeholder:"文章标题",maxlength:"256",clearable:""},null,8,["value"])]),_:1}),r(o(h),{label:"别名",path:"slug",rule:{required:!0,message:"请输入文章别名"}},{default:s(()=>[r(o(A),null,{default:s(()=>[r(o(C),{value:e.slug,"onUpdate:value":l[1]||(l[1]=a=>e.slug=a),placeholder:"文章别名",maxlength:"256",clearable:""},null,8,["value"]),r(o(U),null,{trigger:s(()=>[r(o(M),{onClick:Q},{icon:s(()=>[r(o(B),null,{default:s(()=>[r(o(We))]),_:1})]),_:1})]),default:s(()=>[Xe]),_:1})]),_:1})]),_:1}),r(o(h),{label:"摘要",path:"excerpt"},{default:s(()=>[r(o(A),null,{default:s(()=>[r(o(C),{value:e.excerpt,"onUpdate:value":l[2]||(l[2]=a=>e.excerpt=a),placeholder:e.autoGenerateExcerpt?"根据文章内容自动生成":"文章摘要",maxlength:"512",clearable:"",disabled:e.autoGenerateExcerpt},null,8,["value","placeholder","disabled"]),r(o(U),null,{trigger:s(()=>[r(o(M),{onClick:X},{icon:s(()=>[r(o(B),null,{default:s(()=>[e.autoGenerateExcerpt?(g(),L(o(Be),{key:0})):(g(),L(o(De),{key:1}))]),_:1})]),_:1})]),default:s(()=>[i("span",null,fe(e.autoGenerateExcerpt?"根据文章内容自动生成":"手动填写"),1)]),_:1})]),_:1})]),_:1}),r(o(h),{label:"分类",path:"category"},{default:s(()=>[r(o(q),{options:D.value,value:_.value,"onUpdate:value":Z,onSearch:ee,onClear:l[3]||(l[3]=a=>_.value=void 0),filterable:"",tag:"",remote:"",clearable:""},null,8,["options","value"])]),_:1}),r(o(h),{label:"标签",path:"tag"},{default:s(()=>[r(o(q),{options:$.value,value:f.value,"onUpdate:value":te,onSearch:le,onClear:l[4]||(l[4]=a=>f.value=Array()),"render-tag":ae,"render-label":oe,multiple:"",filterable:"",tag:"",remote:"",clearable:""},null,8,["options","value"])]),_:1}),r(o(h),{label:"封面",path:"cover"},{default:s(()=>[r(o(A),null,{default:s(()=>[r(o(C),{value:e.cover,"onUpdate:value":l[5]||(l[5]=a=>e.cover=a),placeholder:"文章封面地址",maxlength:"256",clearable:""},null,8,["value"]),r(o(U),null,{trigger:s(()=>[r(o(M),{onClick:l[6]||(l[6]=()=>{})},{icon:s(()=>[r(o(B),null,{default:s(()=>[r(o(he))]),_:1})]),_:1})]),default:s(()=>[Ze]),_:1})]),_:1})]),_:1}),r(o(Ee),null,{default:s(()=>[r(o(z),{depth:"3",style:{"font-size":"0.9em"}},{default:s(()=>[ge("进阶设置")]),_:1})]),_:1}),r(o(h),{label:"密码",path:"password"},{default:s(()=>[r(o(A),null,{default:s(()=>[r(o(C),{value:e.password,"onUpdate:value":l[7]||(l[7]=a=>e.password=a),placeholder:e.encrypted?"文章已设置密码":"文章密码",maxlength:"128",clearable:"",disabled:e.encrypted},null,8,["value","placeholder","disabled"]),e.encrypted?(g(),L(o(U),{key:0},{trigger:s(()=>[r(o(M),{onClick:l[8]||(l[8]=a=>e.encrypted=!1)},{icon:s(()=>[r(o(B),null,{default:s(()=>[r(o(Re))]),_:1})]),_:1})]),default:s(()=>[et]),_:1})):me("",!0)]),_:1})]),_:1}),r(o(h),{label:"评论",path:"allowComment"},{default:s(()=>[r(o(G),{value:e.allowComment,"onUpdate:value":l[9]||(l[9]=a=>e.allowComment=a)},{checked:s(()=>[tt]),unchecked:s(()=>[lt]),_:1},8,["value"])]),_:1}),r(o(h),{label:"置顶",path:"pinned"},{default:s(()=>[r(o(G),{value:e.pinned,"onUpdate:value":l[10]||(l[10]=a=>e.pinned=a)},{checked:s(()=>[at]),unchecked:s(()=>[ot]),_:1},8,["value"])]),_:1}),r(o(h),{label:"状态",path:"status"},{default:s(()=>[r(o(G),{value:e.status,"onUpdate:value":l[11]||(l[11]=a=>e.status=a),"checked-value":o(E).PUBLISHED,"unchecked-value":o(E).DRAFT},{checked:s(()=>[nt]),unchecked:s(()=>[st]),_:1},8,["value","checked-value","unchecked-value"])]),_:1}),r(o(h),{label:"可见性",path:"visible"},{default:s(()=>[r(o(G),{value:e.visible,"onUpdate:value":l[12]||(l[12]=a=>e.visible=a),"checked-value":o(S).VISIBLE,"unchecked-value":o(S).HIDDEN},{checked:s(()=>[rt]),unchecked:s(()=>[ut]),_:1},8,["value","checked-value","unchecked-value"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1},8,["show","loading"]))}});export{E as P,We as R,Lt as _,S as a,mt as b,xt as c,wt as d,yt as e,Et as f,Ct as g,Pt as h,Tt as i,vt as j,$t as k,St as l,Nt as m,It as n,Dt as o,bt as p,_t as r,kt as u};
