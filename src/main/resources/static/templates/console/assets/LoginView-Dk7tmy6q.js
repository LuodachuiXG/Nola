import{s as q,d as P,e as f,f as B,g as z,h as j,i as y,j as _,l as D,S as G,r as J,R as H,c as Q,k as S,w as o,u as l,m as A,n as W,o as N,a as t,p as d,q as i,t as m,v as u,N as I,b as K,x as U,y as X,z as Y,A as F,B as Z,_ as $}from"./index-BeAjLgC_.js";function ee(){return q({url:"/api/config/blog",method:"GET"})}function ae(p,n){return q({url:"/admin/config/blog",method:"POST",data:{title:p,subtitle:n}})}function le(p,n,w,b){return q({url:"/admin/config/blog/admin",method:"POST",data:{username:p,displayName:n,email:w,password:b}})}const T=p=>(X("data-v-c3f3d7fe"),p=p(),Y(),p),te=T(()=>F("img",{class:"logo",src:Z,alt:"Nola"},null,-1)),oe=T(()=>F("br",null,null,-1)),se=P({__name:"LoginView",setup(p){const n=f(0),w=f(),b=f(null),v=B({username:"",password:""}),c=f(!1),L=f(null),g=B({title:"",subtitle:""}),k=f(!1),R=f(null),s=B({username:"",displayName:"",email:"",password:"",passwordA:""}),h=f(!1);z(()=>{C(),document.addEventListener("keydown",E)}),j(()=>{document.removeEventListener("keydown",E)});function E(r){if(r.key==="Enter")switch(n.value){case 0:M();break;case 2:x();break;case 1:V();break}}const C=()=>{ee().then(r=>{var e;w.value=r.data,w.value===null?n.value=1:((e=w.value)==null?void 0:e.blogger)===null?n.value=2:n.value=0}).catch(r=>{y("获取博客信息失败，"+r)})},V=()=>{var r;(r=L.value)==null||r.validate(e=>{e||(k.value=!0,ae(g.title,g.subtitle).then(()=>{_("博客初始化成功"),C(),k.value=!1}).catch(a=>{y(a),k.value=!1}))}).catch(()=>{})},x=()=>{var r;(r=R.value)==null||r.validate(e=>{e||(h.value=!0,le(s.username,s.displayName,s.email,s.password).then(a=>{a.data?(_("管理员创建成功"),C()):y("创建管理员失败，请查看后台日志"),h.value=!1}).catch(a=>{y(a),h.value=!1}))}).catch(()=>{})},M=()=>{var r;(r=b.value)==null||r.validate(e=>{e||(c.value=!0,D(v.username,v.password).then(a=>{localStorage.setItem(G.USER,JSON.stringify(a.data)),J.push(H.MAIN.name),c.value=!1}).catch(a=>{y(a),c.value=!1}))}).catch(()=>{})},O=(r,e)=>e===s.password;return(r,e)=>(N(),Q("div",{class:"container",style:W(n.value===2?"margin-top:0;":"")},[te,oe,n.value===0?(N(),S(l(U),{key:0,ref_key:"formLoginRef",ref:b,class:"form",model:v,"show-label":!1},{default:o(()=>[t(l(u),{path:"username",rule:{required:!0,message:"请输入用户名"}},{default:o(()=>[t(l(d),{value:v.username,"onUpdate:value":e[0]||(e[0]=a=>v.username=a),placeholder:"用户名",onKeydown:e[1]||(e[1]=i(m(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1}),t(l(u),{path:"password",rule:{required:!0,message:"请输入密码"}},{default:o(()=>[t(l(d),{value:v.password,"onUpdate:value":e[2]||(e[2]=a=>v.password=a),placeholder:"密码",type:"password","show-password-on":"mousedown",onKeydown:e[3]||(e[3]=i(m(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1}),t(l(u),null,{default:o(()=>[t(l(I),{type:"primary",onClick:M,style:{width:"100%"},loading:c.value},{default:o(()=>[K("登录")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])):A("",!0),n.value===1?(N(),S(l(U),{key:1,ref_key:"formCreateBlogRef",ref:L,class:"form",model:g,"show-label":!1},{default:o(()=>[t(l(u),{path:"title",rule:{required:!0,message:"请输入站点标题"}},{default:o(()=>[t(l(d),{value:g.title,"onUpdate:value":e[4]||(e[4]=a=>g.title=a),placeholder:"站点标题",onKeydown:e[5]||(e[5]=i(m(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1}),t(l(u),{path:"subtitle",rule:{required:!0,message:"请输入站点副标题"}},{default:o(()=>[t(l(d),{value:g.subtitle,"onUpdate:value":e[6]||(e[6]=a=>g.subtitle=a),placeholder:"站点副标题",onKeydown:e[7]||(e[7]=i(m(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1}),t(l(u),null,{default:o(()=>[t(l(I),{type:"primary",onClick:V,style:{width:"100%"},loading:k.value},{default:o(()=>[K(" 初始化博客 ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])):A("",!0),n.value===2?(N(),S(l(U),{key:2,ref_key:"formCreateAdminRef",ref:R,class:"form",model:s,"show-label":!1},{default:o(()=>[t(l(u),{path:"username",rule:[{required:!0,message:"请输入用户名"},{min:4,message:"用户名不能小于 4 位",trigger:"blur"}]},{default:o(()=>[t(l(d),{value:s.username,"onUpdate:value":e[8]||(e[8]=a=>s.username=a),placeholder:"用户名",onKeydown:e[9]||(e[9]=i(m(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1}),t(l(u),{path:"displayName",rule:{required:!0,message:"请输入显示名称"}},{default:o(()=>[t(l(d),{value:s.displayName,"onUpdate:value":e[10]||(e[10]=a=>s.displayName=a),placeholder:"显示名称",onKeydown:e[11]||(e[11]=i(m(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1}),t(l(u),{path:"email",rule:[{required:!0,message:"请输入邮箱"},{type:"email",message:"邮箱不正确",trigger:"blur"}]},{default:o(()=>[t(l(d),{value:s.email,"onUpdate:value":e[12]||(e[12]=a=>s.email=a),placeholder:"邮箱",onKeydown:e[13]||(e[13]=i(m(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1}),t(l(u),{path:"password",rule:[{required:!0,message:"请输入密码"},{min:8,message:"密码不能小于 8 位",trigger:"blur"}]},{default:o(()=>[t(l(d),{value:s.password,"onUpdate:value":e[14]||(e[14]=a=>s.password=a),type:"password","show-password-on":"mousedown",placeholder:"密码",onKeydown:e[15]||(e[15]=i(m(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1}),t(l(u),{path:"passwordA",rule:[{required:!0,message:"请输入密码"},{validator:O,message:"两次密码不一致",trigger:"blur"}]},{default:o(()=>[t(l(d),{value:s.passwordA,"onUpdate:value":e[16]||(e[16]=a=>s.passwordA=a),type:"password","show-password-on":"mousedown",placeholder:"重复密码",onKeydown:e[17]||(e[17]=i(m(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1},8,["rule"]),t(l(u),null,{default:o(()=>[t(l(I),{type:"primary",onClick:x,style:{width:"100%"},loading:h.value},{default:o(()=>[K(" 创建管理员 ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])):A("",!0)],4))}}),ne=$(se,[["__scopeId","data-v-c3f3d7fe"]]);export{ne as default};
